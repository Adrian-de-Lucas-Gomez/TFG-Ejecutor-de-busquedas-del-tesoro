{"ast":null,"code":"var _jsxFileName = \"C:\\\\Universidad\\\\4Universidad\\\\TFG\\\\TFG-Ejecutor-de-busquedas-del-tesoro\\\\ReactDesdeEjemplo\\\\src\\\\components\\\\formOne\\\\steps\\\\Qr.tsx\",\n    _s = $RefreshSig$();\n\nimport QRCode from \"qrcode.react\";\nimport React, { useState, useRef, useEffect } from \"react\";\nimport '../../Styles/QR.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst QR = props => {\n  _s();\n\n  //Referencia en el DOM al div que contiene el QR que renderizamos\n  const qrRef = useRef(null); //Donde guardamos el texto a codificar en QR\n\n  const [text, setText] = useState(\"\");\n  const [sobreEscribir, setSobreEscribir] = useState(false);\n  useEffect(() => {\n    //En caso de que haya que sobreescribir algo, me guardo que estamos sobreescribiendo y cargo \n    //los datos que ya había de esta fase      \n    if (props.getState('SobreEscribir', false)) {\n      //Indico que ya no es necesario sobreescribir nada, porque ya nos encargamos\n      setSobreEscribir(true);\n      props.setState('SobreEscribir', false, false); //Me quedo con lo que haya que sobreescribir\n\n      let new_state = props.getState('DATA', []);\n      let estadoACargar = new_state[props.getState('FaseConfigurable', 1)]; //Me guardo tando la pregunta como las respuestas que había configuradas\n\n      setText(estadoACargar.QRText);\n    } //Este cógigo se ejecuta EXCLUSIVAMENTE cuando se va a desmontar el componente\n\n\n    return () => {}; //Si algo cambia en le tema de sobreescribir nos actualizamos para poder adquirir los datos de la fase a RECONFIGURAR\n  }, [props.getState('SobreEscribir', false)]); //Metodo que se encarga de convertir el qr a formato png y descargarlo\n\n  const downloadQRCode = evt => {\n    //No refrescamos la pagina\n    evt.preventDefault(); //@ts-ignore (Esto es pa que no salte un error de typescript, sin esto no compila (porque asimila que es null))\n    //Cogemos el primer elemento canvas que cuelga del div al que esta asociado la referencia\n    // (qrcode.react esta representado como un <canvas></canvas>, si estuviese representado\n    //con otra etiqueta habria que poner esa)\n\n    let canvas = qrRef.current.querySelector(\"canvas\"); //devuelve un data URI el cual contiene una representación de una imagen en png\n\n    let image = canvas.toDataURL(\"image/png\"); //Creamos un componente <a> html al que vamos a asignar la informacion\n    //del QR qur vamos a descargar\n\n    let anchor = document.createElement(\"a\"); //le asignamos como referencia el qr ya convertido en imagen\n\n    anchor.href = image; //Le ponemos el nombre con el que la vamos a descargar\n\n    anchor.download = text + `.png`; //Metemos el componente <a> en el cuerpo de nuestro html de react\n\n    document.body.appendChild(anchor); //Clicamos sobre el para descargarlo\n\n    anchor.click(); //Quitamos el componente <a> puesto que ya ha cumplido su funcion\n\n    document.body.removeChild(anchor);\n  }; //Metodo utilizado para guardar los datos que actuales del\n  //QR en el registro de fases actual de la aventura\n\n\n  const guardaFase = e => {\n    //Para que no se refresque la pagina en el onSubmit\n    e.preventDefault(); //Miro a ver si hay algo que pueda guardar\n\n    if (text !== \"\") {\n      console.log(\"Llamada a guardar fase\"); //ME hago con el estado actual del array de info de la aventura\n\n      let new_state = props.getState('DATA', []); //Preparo los datos que voy a añadir\n\n      let myData = {\n        tipo: \"QRStage\",\n        QRText: text\n      };\n      console.log(new_state); //Los añado a una copia del estado y establezco esta copia como el estadoa actual de las fases            \n\n      if (sobreEscribir === true) {\n        //De esta forma se puede meter el estado en unaposicion concreta en lugar de hacerlo en el final siempre\n        let position = props.getState('FaseConfigurable', 1);\n        new_state.splice(position, 1, myData);\n      } //Si no hay que sobreescribir nada simplemente pusheamos al final de los datos\n      else {\n        //Lo almaceno en la lista de fases que tengo disponibles\n        let position = props.getState('WhereToPush', 1);\n        new_state.splice(position, 0, myData);\n      }\n\n      props.setState('DATA', new_state, []); //Importante aumentar el indice de donde estamos metiendo nuevos elementos a la aventura para que no \n      //se metan todos en la posicion X y que luego estén TODOS EN ORDEN INVERSO\n\n      props.setState('WhereToPush', props.getState('WhereToPush', 1) + 1, 1);\n    } else {\n      alert(\"Rellena bien\");\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"Titulo\",\n      children: \"A\\xF1ada aqui el link al que reedirige el  QR:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: e => e.preventDefault(),\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"QRForm\",\n        type: \"text\",\n        required: true,\n        value: text,\n        onChange: e => setText(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: qrRef,\n      children: /*#__PURE__*/_jsxDEV(QRCode, {\n        className: \"QRImage\",\n        value: text,\n        size: 400,\n        fgColor: \"black\",\n        bgColor: \"white\",\n        level: \"H\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"grid\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"fondoA\",\n        children: /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: downloadQRCode,\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"QRButton\",\n            type: \"submit\",\n            children: \"Descargar QR\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: guardaFase,\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"QRButton\",\n            type: \"submit\",\n            children: \"Guardar Fase\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 130,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 112,\n    columnNumber: 5\n  }, this);\n};\n\n_s(QR, \"W8R1z+DFc+F6ViOx3fpO/Scvy80=\");\n\n_c = QR;\nexport default QR;\n\nvar _c;\n\n$RefreshReg$(_c, \"QR\");","map":{"version":3,"sources":["C:/Universidad/4Universidad/TFG/TFG-Ejecutor-de-busquedas-del-tesoro/ReactDesdeEjemplo/src/components/formOne/steps/Qr.tsx"],"names":["QRCode","React","useState","useRef","useEffect","QR","props","qrRef","text","setText","sobreEscribir","setSobreEscribir","getState","setState","new_state","estadoACargar","QRText","downloadQRCode","evt","preventDefault","canvas","current","querySelector","image","toDataURL","anchor","document","createElement","href","download","body","appendChild","click","removeChild","guardaFase","e","console","log","myData","tipo","position","splice","alert","target","value"],"mappings":"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","sourcesContent":["import QRCode from \"qrcode.react\";\r\nimport React, {useState, useRef, useEffect, forwardRef, useImperativeHandle} from \"react\"\r\nimport { StepComponentProps } from '../../Steps';\r\nimport { queries } from \"@testing-library/react\";\r\nimport '../../Styles/QR.css'\r\n\r\n\r\nconst QR = (props: StepComponentProps): JSX.Element => {\r\n  \r\n    //Referencia en el DOM al div que contiene el QR que renderizamos\r\n    const qrRef = useRef(null);\r\n    //Donde guardamos el texto a codificar en QR\r\n    const [text, setText] = useState<string>(\"\");\r\n   type FormElement = React.FormEvent<HTMLFormElement>;\r\n   const [sobreEscribir, setSobreEscribir] = useState<boolean>(false);\r\n\r\n\r\n   useEffect(() => {\r\n\r\n    //En caso de que haya que sobreescribir algo, me guardo que estamos sobreescribiendo y cargo \r\n    //los datos que ya había de esta fase      \r\n    if(props.getState<boolean>('SobreEscribir', false)){\r\n\r\n        //Indico que ya no es necesario sobreescribir nada, porque ya nos encargamos\r\n        setSobreEscribir(true);\r\n        props.setState('SobreEscribir', false, false);\r\n\r\n        //Me quedo con lo que haya que sobreescribir\r\n        let new_state = props.getState<any>('DATA', []); \r\n        let estadoACargar = new_state[props.getState<number>('FaseConfigurable',1)];\r\n\r\n        //Me guardo tando la pregunta como las respuestas que había configuradas\r\n        setText(estadoACargar.QRText);\r\n    }\r\n    \r\n    //Este cógigo se ejecuta EXCLUSIVAMENTE cuando se va a desmontar el componente\r\n    return () => {}\r\n    //Si algo cambia en le tema de sobreescribir nos actualizamos para poder adquirir los datos de la fase a RECONFIGURAR\r\n  }, [props.getState<boolean>('SobreEscribir', false)]);\r\n\r\n\r\n\r\n    //Metodo que se encarga de convertir el qr a formato png y descargarlo\r\n    const downloadQRCode = (evt: React.FormEvent) => {\r\n        //No refrescamos la pagina\r\n        evt.preventDefault();\r\n        //@ts-ignore (Esto es pa que no salte un error de typescript, sin esto no compila (porque asimila que es null))\r\n        //Cogemos el primer elemento canvas que cuelga del div al que esta asociado la referencia\r\n        // (qrcode.react esta representado como un <canvas></canvas>, si estuviese representado\r\n        //con otra etiqueta habria que poner esa)\r\n        let canvas = qrRef.current.querySelector(\"canvas\");\r\n        \r\n        //devuelve un data URI el cual contiene una representación de una imagen en png\r\n        let image:string = canvas.toDataURL(\"image/png\");\r\n        \r\n        //Creamos un componente <a> html al que vamos a asignar la informacion\r\n        //del QR qur vamos a descargar\r\n        let anchor:HTMLAnchorElement = document.createElement(\"a\");\r\n        //le asignamos como referencia el qr ya convertido en imagen\r\n        anchor.href = image;\r\n        //Le ponemos el nombre con el que la vamos a descargar\r\n        anchor.download = text +`.png`;\r\n        //Metemos el componente <a> en el cuerpo de nuestro html de react\r\n        document.body.appendChild(anchor);\r\n        //Clicamos sobre el para descargarlo\r\n        anchor.click();\r\n        //Quitamos el componente <a> puesto que ya ha cumplido su funcion\r\n        document.body.removeChild(anchor);\r\n      };\r\n\r\n\r\n    //Metodo utilizado para guardar los datos que actuales del\r\n    //QR en el registro de fases actual de la aventura\r\n    const guardaFase = (e:FormElement) => {\r\n        //Para que no se refresque la pagina en el onSubmit\r\n        e.preventDefault();\r\n\r\n        //Miro a ver si hay algo que pueda guardar\r\n        if (text !== \"\"){\r\n            console.log(\"Llamada a guardar fase\")\r\n            //ME hago con el estado actual del array de info de la aventura\r\n            let new_state = props.getState<any>('DATA', []); \r\n            //Preparo los datos que voy a añadir\r\n            let myData = {tipo:\"QRStage\" ,QRText: text};\r\n            console.log(new_state);\r\n\r\n            //Los añado a una copia del estado y establezco esta copia como el estadoa actual de las fases            \r\n            if(sobreEscribir === true){\r\n                //De esta forma se puede meter el estado en unaposicion concreta en lugar de hacerlo en el final siempre\r\n                let position = props.getState<number>('FaseConfigurable',1);\r\n                new_state.splice(position,1,myData);\r\n            }\r\n            //Si no hay que sobreescribir nada simplemente pusheamos al final de los datos\r\n            else {\r\n                //Lo almaceno en la lista de fases que tengo disponibles\r\n                let position = props.getState<number>('WhereToPush',1);\r\n                new_state.splice(position, 0, myData);\r\n            }\r\n            \r\n            props.setState('DATA',new_state,[]);\r\n            //Importante aumentar el indice de donde estamos metiendo nuevos elementos a la aventura para que no \r\n            //se metan todos en la posicion X y que luego estén TODOS EN ORDEN INVERSO\r\n            props.setState<number>('WhereToPush',props.getState<number>('WhereToPush',1)+1,1);\r\n        }\r\n        else{\r\n            alert(\"Rellena bien\");\r\n        }\r\n    }\r\n\r\n \r\n    return (\r\n    <div >\r\n        <h3 className=\"Titulo\" >Añada aqui el link al que reedirige el  QR:</h3>\r\n        <form onSubmit={e => e.preventDefault()}>\r\n            <input  className='QRForm' type=\"text\" required value={text} onChange ={ e =>setText(e.target.value)}></input>\r\n        </form>\r\n        <div ref={qrRef}>\r\n            <QRCode className='QRImage' value={text} size={400} fgColor=\"black\" bgColor=\"white\" level=\"H\"  />\r\n        </div>\r\n\r\n        <div className = 'grid'>\r\n            <div className=\"fondoA\">\r\n                <form onSubmit= {downloadQRCode}>\r\n                    <button className='QRButton' type=\"submit\">Descargar QR</button>\r\n                </form>\r\n            </div>\r\n                \r\n            <div>\r\n                <form onSubmit= {guardaFase}>\r\n                        <button className='QRButton' type=\"submit\">Guardar Fase</button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n    )\r\n};\r\nexport default QR;"]},"metadata":{},"sourceType":"module"}